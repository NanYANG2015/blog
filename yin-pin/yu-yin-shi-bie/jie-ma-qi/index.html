<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="解码器, AI, 语音, 算法">
    <meta name="description" content="1. 参数

beam: 每一帧保留的token的cost
与当前帧最优cost的最大允许差值。越大，解码越慢，内存占用越大，但越准确。默认值16.0（即路径概率约为1.1e-07
= 1/exp(16) 倍）。
max_acti">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>解码器 | 梦园</title>
    <link rel="icon" type="image/png" href="/blog/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/blog/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/blog/css/matery.css">
<link rel="stylesheet" type="text/css" href="/blog/css/my.css">
<link rel="stylesheet" type="text/css" href="/blog/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/blog/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/blog/css/post.css">




    



    <script src="/blog/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.1.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">梦园</div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/" class="waves-effect waves-light">
      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/categories" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/blog/about">
          
          <i class="fas fa-user-circle" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>我</span>
        </a>
      </li>
      
      <li>
        <a href="/blog/words">
          
          <i class="fas fa-pen" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>文字</span>
        </a>
      </li>
      
      <li>
        <a href="/blog/books">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>书</span>
        </a>
      </li>
      
      <li>
        <a href="/blog/videos">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>视频</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/blog/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">梦园</div>
        <div class="logo-desc">
            
            愿，彼此相伴，走过流年
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/blog/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-list"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-user-circle"></i>
			
			关于
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/blog/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-circle" style="position: absolute;left:50px" ></i>
			      
		          <span>我</span>
                  </a>
                </li>
              
                <li>

                  <a href="/blog/words " style="margin-left:75px">
				  
				   <i class="fa fas fa-pen" style="position: absolute;left:50px" ></i>
			      
		          <span>文字</span>
                  </a>
                </li>
              
                <li>

                  <a href="/blog/books " style="margin-left:75px">
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>书</span>
                  </a>
                </li>
              
                <li>

                  <a href="/blog/videos " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>视频</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/blog/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/blog/';
            }
        }
    })();
</script>


<div class="bg-cover pd-header about-cover">
    <div class="container">
    <div class="row">
    <div class="col s10 offset-s1 m8 offset-m2 l8 offset-l1">
        <div class="brand">
            <div class="title">
                
                愿，彼此相伴，走过流年
                
            </div>
        </div>
    </div>
</div>

    </div>
</div>



<main class="post-container content">

    
    <style>
    /* 随视窗调整大小、滚动 */
    #toc-content {
        height: calc(100vh - 200px);
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="pd-header post-cover">
                <div class="container" style="right: 0px;left: 0px;">
                    <div class="row">
                        <div class="col s12 m12 l12">
                            <div class="brand">
                                <h1 class="description center-align post-title">解码器</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tag-cate">
                <div class="right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/blog/categories/%E9%9F%B3%E9%A2%91/" class="post-category">
                                音频
                            </a>
                        
                            <a href="/blog/categories/%E9%9F%B3%E9%A2%91/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/" class="post-category">
                                语音识别
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-05-03
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-10-29
                </div>
                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/blog/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="参数">1. 参数</h1>
<ul>
<li>beam: 每一帧保留的token的cost
与当前帧最优cost的最大允许差值。越大，解码越慢，内存占用越大，但越准确。默认值16.0<font color="green">（即路径概率约为1.1e-07
= 1/exp(16) 倍）</font>。</li>
<li>max_active:
每一帧可以激活的最大状态数。越大，解码越慢，内存占用越大，但越准确。默认值7000。</li>
<li>min_active: 每一帧需要激活的最小状态数。默认值200。</li>
<li><a href="#lattice_beam">lattice_beam</a>: Lattice
Decoder中，跳转弧到达当前最后一帧active token
A的最优路径的cost与到达A的最优路径的cost的最大允许差值（对于当前最后一帧的多个active
tokens，其一满足即可）。默认值6.0<font color="green">（即路径概率约为0.0025
= 1/exp(6) 倍）</font>。</li>
<li><a href="#beam_delta">beam_delta</a>:
FasterDecoder中，用于根据前一帧估计当前帧的<code>adaptive_beam</code>。默认值0.5。</li>
<li>prune_interval: Lattice
Decoder中，每隔多少帧裁剪过去帧的tokens。默认值20。</li>
<li><a href="#prune_scale">prune_scale</a>: Lattice
Decoder中，若token的extra
cost变大（假设上一次PruneActiveTokens时，该token计算extra
cost对应的是当时最后一帧的token
A，当A不在到达当前最后一帧的最优路径上时，该token的extra
cost就会变大）（变化量，而非值）超过<code>lattice_beam * prune_scale</code>，则需要判断之前的帧是否需要裁剪。越大，则向前回溯得越少（内存与解码速度的均衡）。默认值0.1。</li>
<li><a href="#hash_ratio">hash_ratio</a>：FasterDecoder中，用于设置存储tokens的哈希表的容量。默认值2。</li>
<li>length_penalty：LatticeFasterDecoder中，每跳转到一个新的状态（排除了状态自旋、epsilon弧），graph
cost加上length_penalty。&gt;0则倾向于短句子，&lt;0时倾向于长句子。默认值0.0。</li>
</ul>
<h1 id="数据结构">2. 数据结构</h1>
<ul>
<li>DecodableInterface:
为了最小化解码器和声学模型代码之间的交互，创建了该基类。DecodableInterface
对象可以视为LogLikelihood矩阵。
<ul>
<li>BaseFloat LogLikelihood(int32 frame, int32 index): 返回索引(frame,
index)对应的声学log-likelihood。若已计算，则直接返回值；否则调用声学模型计算。可能还包含减log_priors、乘acoustic_scale等处理。
<ul>
<li>acoustic_scale：默认值0.1。</li>
</ul></li>
<li>int32 NumFramesReady():
根据已计算的声学特征，可得到的LogLikelihood帧数（声学模型可能包含降采样、特征上下文等处理）。</li>
<li>bool IsLastFrame(int32 frame):
是否为最后一帧（若为online模式，则须输入结束）。</li>
</ul></li>
<li>Decoder
<ul>
<li>构造decoder需要传入fst和相关配置参数。</li>
</ul></li>
<li>Token（以下主要以Lattice Decoder为例）
<ul>
<li>每一帧、每个激活的状态各由一个Token表示。</li>
<li>BaseFloat tot_cost: 从句子开头到当前状态的AM + LM cost (ac_cost +
graph_cost)。
<ul>
<li>vector&lt;BaseFloat&gt; cost_offsets_: 每一帧，AM log-likelihoods
加的 offset，使其接近0，减小roundoff的误差。</li>
</ul></li>
<li>BaseFloat extra_cost: 认为当前最后一帧的各active
token都有可能在最终的最优路径上，extra_cost均为0；其它帧token的extra
cost为：经过该token到达当前最后一帧active
token（计为A）的最优路径，与到达A的最优路径的cost差值；对于当前最后一帧的多个active
tokens，取这些cost差值的最小值。在PruneForwardLinks(Final)中计算。</li>
<li>ForwardLink<stdtoken> *links:
该token到下一帧的跳转弧（或跳转到当前帧的epsilon弧）的单链表
<ul>
<li>fst::StdArc::Label ilabel</li>
<li>fst::StdArc::Label olabel</li>
<li>BaseFloat acoustic_cost: cost_offset - logLikelihood</li>
<li>BaseFloat graph_cost:
arc.weight，包含状态转移模型概率、词典发音概率、静音概率、LM概率等</li>
<li>Token *next_tok：跳转到的下一个token</li>
<li>ForwardLink *next：单链表结构</li>
</ul></stdtoken></li>
<li>Token *backpointer:
到达当前token的最优路径上的上一token。用于LatticeFasterOnlineDecoder中高效地GetBestPath。</li>
<li>Token *next: 该帧的下一token</li>
<li>非Lattice Decoder中还包含：
<ul>
<li>int32 ref_count_:
该token跳转到的token的数量+1。当该token不再在到达当前最后一帧的各active
token的最优路径上时（ref_count==1），删除到达该token的路径上的所有无用token（TokenDelete）。</li>
<li>Token *prev_: 路径中的上一个token，唯一，用于回溯。
<ul>
<li>Lattice
Decoder记录路径中的下一token，链表，多个。<font color="green">更高效</font>。GetBestPath中，先顺序遍历每一帧的active
tokens 生成lattice，再采用 openfst 的 ShortestPath 返回最优路径。</li>
</ul></li>
<li>arc_.nextstate 当前状态</li>
</ul></li>
</ul></li>
</ul>
<h1 id="解码器类型">3. 解码器类型</h1>
<h2 id="simpledecoder">3.1. SimpleDecoder</h2>
<ul>
<li>采用<code>unordered_map&lt;StateId, Token*&gt; cur_toks_, prev_toks_</code>
分别存储当前帧和前一帧的active tokens。</li>
<li>Viterbi beam search。</li>
</ul>
<p>核心流程如下： <pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">InitDecoding();
while (num_frames_decoded_ &lt; target_frames_decoded) &#123;
    &#x2F;&#x2F; note: ProcessEmitting() increments num_frames_decoded_
    ClearToks(prev_toks_);  &#x2F;&#x2F; 删除历史无用路径，并清空prev_toks_
    cur_toks_.swap(prev_toks_);
    ProcessEmitting(decodable);  &#x2F;&#x2F; 处理发射弧，将token从上一帧传播到当前帧
    ProcessNonemitting();  &#x2F;&#x2F; 处理当前帧token的epsilon弧
    PruneToks(beam_, &amp;cur_toks_);  &#x2F;&#x2F; 再次裁剪（因为ProcessEmitting中的cutoff是动态更新的）
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="fasterdecoder">3.2. FasterDecoder</h2>
<ul>
<li>采用<code>HashList&lt;StateId, Token*&gt; toks_</code>
存储tokens，其元素可以通过哈希表访问，也可以通过单链表访问。token传播时，先清空哈希表，前一帧的active
tokens仅可以通过单链表访问，当前帧的active tokens还可以通过哈希表访问。
<ul>
<li>创建新token时，需要查询对应的状态是否已存在token，相较于unordered_map的遍历查找，采用哈希表查找速度更快。</li>
</ul></li>
<li>采用<code>max-active</code>、<code>min-active</code> 调整裁剪。</li>
</ul>
<p>核心流程如下： <pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">InitDecoding();
while (num_frames_decoded_ &lt; target_frames_decoded) &#123;
    double weight_cutoff &#x3D; ProcessEmitting(decodable);
    ProcessNonemitting(weight_cutoff);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="biglmfasterdecoder">3.3. BiglmFasterDecoder</h2>
<ul>
<li>大语言模型：弧数&gt;百万。由于内存限制，很难构建解码图。</li>
<li><font color="red"> 两种处理方式 </font>
<ul>
<li>先采用小LM生成lattice，再用大LM对lattice进行rescore。（小、大指ngram阶数）</li>
<li>采用“biglm” decoder：先采用小LM <code>G</code>
构建HCLG，解码时动态地compose 大LM <span class="math inline">\(G^{\prime}\)</span> 与小LM的差。<span class="math inline">\(HCLG \circ G^{-} \circ G^{\prime}\)</span>，其中
<span class="math inline">\(G^{-}\)</span>
为对<code>G</code>中的权重取负数得到。
<ul>
<li>实现：未采用通用的compose算法，而是采用 <span class="math inline">\((HCLG\text {中的状态}, G^{-} \circ G^{\prime}\text
{中的状态})\)</span> 状态空间，查找指定状态上具有指定输入标签的弧。</li>
<li>缺点：解码较慢。<font color="green">
相较于beam相同、但没有biglm部分的解码器，biglm decoder 耗时几乎为2倍
(疑问：对比时，普通解码器LM大小与biglm
decoder中的<code>G</code>相当，还是与<span class="math inline">\(G^{\prime}\)</span>相当？)</font>。</li>
</ul></li>
</ul></li>
<li>效果：大语言模型的HCLG &gt; biglm decoder &gt; rescore。
<ul>
<li>rescore：采用小LM生成lattice时最优路径有可能被裁剪掉。</li>
<li>biglm decoder：<font color="green"> only updates the 'good' language
model score every time it crosses a word（ChatGPT:
只有在完整的单词被解码时才会更新语言模型分，可以通过减少语言模型需要被评估的次数来加速解码，但是，与在每个声学帧或每个子单元上更新语言模型分相比，可能会导致稍微不太准确的解码结果。）</font></li>
</ul></li>
</ul>
<h2 id="lattice-decoder">3.4. Lattice Decoder</h2>
<ul>
<li>对比
<ul>
<li>one-best解码：只保留到达active状态的最优路径。</li>
<li>lattice解码：若存在多条可行路径到达同一active状态，均保留。</li>
</ul></li>
<li>采用<code>vector&lt;TokenList&gt; active_toks_</code>记录每一帧的active
tokens链表头节点。</li>
<li>采用lattice beam进一步裁剪。</li>
</ul>
<p>核心流程如下： <pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">InitDecoding();
while (NumFramesDecoded() &lt; target_frames_decoded) &#123;
    if (NumFramesDecoded() % config_.prune_interval &#x3D;&#x3D; 0)
      PruneActiveTokens(config_.lattice_beam * config_.prune_scale);
    double weight_cutoff &#x3D; ProcessEmitting(decodable);
    ProcessNonemitting(weight_cutoff);
&#125;
FinalizeDecoding();  &#x2F;&#x2F; 可选，采用lattice beam进行裁剪<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="latticefasteronlinedecoder">3.5. LatticeFasterOnlineDecoder</h2>
<ul>
<li>支持在使用endpointing或其它需要频繁获取最佳路径的场景下，利用backpointer高效计算GetBestPath()。</li>
</ul>
<h2 id="latticeincrementaldecoder">3.6. LatticeIncrementalDecoder</h2>
<ul>
<li>普通解码器LatticeFasterDecoder，用于长语音实时应用时，每次获取lattice时的lattice确定化可能会花费相当多的时间，从而引入延迟。LatticeIncrementalDecoder将lattice确定化分散到整个解码过程中。</li>
<li><font color="green">TODO: 实现</font></li>
<li>术语
<ul>
<li>chunk：对 chunk
帧原始lattice分别进行确定化。长度至少为1个单词，如20帧。</li>
</ul></li>
</ul>
<h1 id="代码解析">4. 代码解析</h1>
<h2 id="decodablenumframesready">4.1. Decodable::NumFramesReady()</h2>
<p>由于声学模型输入特征可能包含上下文，音频中间和末尾的NumFramesReady计算方式可能不一样。</p>
<h2 id="cost_cutoff-processemittingdecodable">4.2. cost_cutoff =
ProcessEmitting(decodable)</h2>
<p>将令牌从前一帧传播到当前帧。</p>
<ul>
<li>GetCutoff：计算上一帧的cutoff
<font color="red">(cur_cutoff)</font>。
<ul>
<li>返回值：同时满足<code>beam</code>、<code>max_active</code>、<code>min_active</code>约束的cost临界值。</li>
<li>adaptive_beam: 自适应估计的有效beam
width。若根据<code>max_active</code>或<code>min_active</code>调整了beam，则为同时满足上述约束的<span class="math inline">\(beam^{\prime}\)</span> + <span id="beam_delta">
<code>beam_delta</code></span>，否则为<code>beam</code>。该值通常 &gt;=
实际有效的beam width，认为采用beam_delta=0.5（默认值）时
该估计值比实际值更严格的情况不会经常发生。</li>
</ul></li>
<li><span id="hash_ratio">PossiblyResizeHash(tok_cnt)：若上一帧的token数<code>tok_cnt</code>
<code>* hash_ratio &gt; toks_.Size()</code>，<code>toks_</code>扩容。</span></li>
<li>初始化当前帧的cutoff
<font color="red">(next_cutoff)</font>：取上一帧的best
state，对其在fst上的各发射弧，计算cost，cutoff取上述cost的最小值 +
adaptive_beam。
<ul>
<li>cost_offsets_[frame] = - best_elem-&gt;val-&gt;tot_cost (best_elem:
上一帧的)</li>
</ul></li>
<li>对于前一帧的各active token (tok)，若满足不被裁剪的条件
<font color="red">（cur_cutoff）</font>，处理其对应状态的各发射弧（即输入标签非0
- epsilon），若满足不被裁剪的条件
<font color="red">（next_cutoff）</font>，则FindOrAddToken，并将新ForwardLink添加至tok-&gt;links头部。动态更新当前帧cutoff。
<ul>
<li>FindOrAddToken：若当前帧已存在与该状态关联的token，判断是否更新tot_cost、backpointer。</li>
</ul></li>
</ul>
<h2 id="processnonemittingcost_cutoff">4.3. ProcessNonemitting(cost_cutoff)</h2>
<ul>
<li>对于当前帧满足cost_cutoff约束的各token，处理其对应状态的各非发射弧（即输入标签为0
-
epsilon）。若仍满足cost_cutoff约束，则FindOrAddToken，并将新ForwardLink添加至tok-&gt;links头部。</li>
<li>采用队列（queue）遍历含epsilon弧的token。若FindOrAddToken中新添加的token
或 更新了tot_cost的token 也含Epsilon弧，也加入queue。
<ul>
<li>DeleteForwardLinks(tok)：若 tok 存在 ForwardLinks，则一定为 epsilon
弧，且再次在queue中，则 tot_cost
减小了，因此DeleteForwardLinks，并重新处理其所有的 epsilon 弧。</li>
</ul></li>
</ul>
<h2 id="pruneactivetokens">4.4. PruneActiveTokens</h2>
<p>逆序遍历每一帧（不包含当前帧），如果该帧还未被该函数访问过(new
TokenList)，或者下一帧存在token extra_cost变化超过<span id="prune_scale"> delta （= config_.lattice_beam *
config_.prune_scale）</span>，对该帧token的forward link进行裁剪（若
link_extra_cost &gt; <span id="lattice_beam">
config_.lattice_beam</span>），并删除下一帧 forward link 均被裁剪了的
token。</p>
<pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">&#x2F;&#x2F; delta &#x3D; config_.lattice_beam * config_.prune_scale
void PruneActiveTokens(BaseFloat delta) &#123;
    int32 cur_frame_plus_one &#x3D; NumFramesDecoded();
    &#x2F;&#x2F; 保留当前最后一帧的所有token，认为其均有可能走到最后(extra cost均为0)。
    for (int32 f &#x3D; cur_frame_plus_one - 1; f &gt;&#x3D; 0; f--) &#123;
        &#x2F;&#x2F; TokenList初始化时must_prune_forward_links默认为true
        &#x2F;&#x2F; 或者，下一帧存在token extra_costs_changed
        if (active_toks_[f].must_prune_forward_links) &#123;
            bool extra_costs_changed &#x3D; false, links_pruned &#x3D; false;
            PruneForwardLinks(f, &amp;extra_costs_changed, &amp;links_pruned, delta);
            if (extra_costs_changed &amp;&amp; f &gt; 0)  &#x2F;&#x2F; 存在token extra_cost变化超过delta
                active_toks_[f-1].must_prune_forward_links &#x3D; true;
            if (links_pruned)  &#x2F;&#x2F; 存在link被裁剪
                active_toks_[f].must_prune_tokens &#x3D; true;
            active_toks_[f].must_prune_forward_links &#x3D; false;
        &#125;
        &#x2F;&#x2F; 必须先裁剪掉前一帧的forward links，再裁剪token，从而避免“悬挂”的forward links
        if (f+1 &lt; cur_frame_plus_one &amp;&amp; active_toks_[f+1].must_prune_tokens) &#123;
            &#x2F;&#x2F; 删除extra_cost为无穷的token
            PruneTokensForFrame(f+1);
            active_toks_[f+1].must_prune_tokens &#x3D; false;
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>PruneForwardLinks:</p>
<pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">&#x2F;&#x2F; 遍历该帧所有token，若extra_cost **变化** 均不超过delta，循环停止。
&#x2F;&#x2F; 由于存在epsilon弧，而链表不保证拓扑顺序，所以需要while循环。
while (changed) &#123;
    changed &#x3D; false;
    &#x2F;&#x2F; 对该帧的所有token
    for (Token *tok &#x3D; active_toks_[frame_plus_one].toks; tok !&#x3D; NULL; tok &#x3D; tok-&gt;next) &#123;
        ForwardLinkT *link, *prev_link &#x3D; NULL;
        BaseFloat tok_extra_cost &#x3D; std::numeric_limits&lt;BaseFloat&gt;::infinity();

        &#x2F;&#x2F; 对该token的所有link
        for (link &#x3D; tok-&gt;links; link !&#x3D; NULL; ) &#123;
            Token *next_tok &#x3D; link-&gt;next_tok;
            &#x2F;&#x2F; a &#x3D; tok-&gt;tot_cost + link-&gt;acoustic_cost + link-&gt;graph_cost 经过该link到达next_tok的tot_cost
            &#x2F;&#x2F; b &#x3D; a - next_tok-&gt;tot_cost 上述tot_cost与到达next_tok的最优路径的cost差值（不会随着后续帧变化）
            &#x2F;&#x2F; link_extra_cost &#x3D; next_tok-&gt;extra_cost + b 经过该link到达当前最后一帧active token（计为A）的最优路径，与到达A的最优路径的cost差值
            BaseFloat link_extra_cost &#x3D; next_tok-&gt;extra_cost + ((tok-&gt;tot_cost + link-&gt;acoustic_cost + link-&gt;graph_cost) - next_tok-&gt;tot_cost);

            &#x2F;&#x2F; if ... 则删除该link
            if (link_extra_cost &gt; config_.lattice_beam) &#123;
                ForwardLinkT *next_link &#x3D; link-&gt;next;
                if (prev_link !&#x3D; NULL) prev_link-&gt;next &#x3D; next_link;
                else tok-&gt;links &#x3D; next_link;
                delete link;
                link &#x3D; next_link;
                *links_pruned &#x3D; true;
            &#125; else &#123;
                if (link_extra_cost &lt; tok_extra_cost)
                    tok_extra_cost &#x3D; link_extra_cost;
                prev_link &#x3D; link;
                link &#x3D; link-&gt;next;
            &#125;
        &#125;
        &#x2F;&#x2F; tok_extra_cost: 若该token的所有forward link均被裁剪，则为无穷大；否则为link_extra_cost的最小值

        &#x2F;&#x2F; 若存在token extra_cost变化量超过delta，则changed为true
        if (fabs(tok_extra_cost - tok-&gt;extra_cost) &gt; delta)
            changed &#x3D; true;
        tok-&gt;extra_cost &#x3D; tok_extra_cost;
    &#125;
    if (changed) *extra_costs_changed &#x3D; true;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<ul>
<li>通常每一帧有数千个active
tokens，因此定期（prune_interval）采用lattice_beam
进行裁剪，而不是等到话语结束才裁剪，否则会OOM。</li>
<li>裁剪算法的时间复杂度接近线性，而不是<span class="math inline">\(O(T^2)\)</span>。对于非常长的语句，通常仅向后裁剪1-2s。另外，绝大多数token在该算法第一次访问时就被删除了。</li>
<li>https://kaldi-asr.org/doc/lattices.html#lattices_generation</li>
</ul>
</blockquote>
<h2 id="finalizedecoding">4.5. FinalizeDecoding</h2>
<p>采用 lattice beam 进行裁剪。与 PruneActiveTokens 的区别： +
PruneForwardLinksFinal：最后一帧特殊处理。 +
<font color="red">若存在token在final状态，则不在final状态的token
extra_cost 为无穷大；否则，不考虑final权重。</font> + 若
link_extra_cost（epsilon弧） &gt; lattice_beam，则删除该link。 + token
的 extra cost 为 经过该token的最优路径 与 全局最优路径 的cost差值。若
&gt; lattice_beam，则设为无穷大。 + 逆序遍历、处理所有帧，不需考虑
delta、must_prune_tokens 等条件。</p>
<h2 id="getbestpath">4.6. GetBestPath</h2>
<ul>
<li><font color="red">参数：use_final_probs。若为true，且存在token在final状态，则仅考虑所有在final状态的token；否则，不考虑final权重。</font></li>
<li>非lattice解码器：从cost最小的token开始回溯，返回线性FST，<font color="green">最后调用RemoveEpsLocal</font>。</li>
<li>lattice 解码器
<ul>
<li>GetRawLattice：根据active_toks_中每一帧的active
tokens，及token间的forwardlink，生成FST。
<ul>
<li><font color="green">TopSortTokens：对一帧的token进行拓扑排序，使得生成的fst上，epsilon弧的起始状态的id
&lt; 结束状态的id。</font></li>
</ul></li>
<li>ShortestPath：调用 OpenFst 的 ShortestPath 算法。</li>
<li>由于epsilon弧，弧数可能比帧数多。</li>
</ul></li>
</ul>
<h2 id="getlattice">4.7. GetLattice</h2>
<ul>
<li><font color="green">TODO: 实现</font></li>
<li>lattice
确定化：只保留每个单词序列的最优路径。确定化前的lattice可用于声学rescore，很大；确定化后的lattice
可用于计算句子级的置信度分、LM rescore。</li>
</ul>
<h1 id="参考资源">5. 参考资源</h1>
<ul>
<li>https://kaldi-asr.org/doc/decoders.html</li>
<li>https://kaldi-asr.org/doc/lattices.html</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <i class="fas fa-exclamation-circle"></i>
            <span>
                本文不允许转载。
            </span>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            
        </div>
    </div>

    

    

    

    

    

    

    

    

    <article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/blog/yin-pin/yu-yin-shi-bie/xu-lie-qu-fen-xing-xun-lian/">
                    <div class="card-content">
                        <span class="card-title">序列区分性训练</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-05-03
                            <i class="far fa-edit fa-fw icon-date"></i>2024-10-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/blog/categories/%E9%9F%B3%E9%A2%91/" class="post-category">
                                    音频
                                </a>
                            
                            <a href="/blog/categories/%E9%9F%B3%E9%A2%91/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/" class="post-category">
                                    语音识别
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/blog/yin-pin/yu-yin-shi-bie/yu-yan-mo-xing/">
                    <div class="card-content">
                        <span class="card-title">语言模型</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-05-03
                                <i class="far fa-edit fa-fw icon-date"></i>2024-10-29
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/blog/categories/%E9%9F%B3%E9%A2%91/" class="post-category">
                                    音频
                                </a>
                            
                            <a href="/blog/categories/%E9%9F%B3%E9%A2%91/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/" class="post-category">
                                    语音识别
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('50')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 梦园<br />'
            + '文章作者: nanyang<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/blog/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/blog/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('6'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/blog/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="5001011615"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/blog/libs/aplayer/APlayer.min.js"></script>
<script src="/blog/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/blog/about" target="_blank">nanyang</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
            
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/NanYANG2015" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2271348390@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2271348390" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2271348390" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/blog/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/blog/libs/materialize/materialize.min.js"></script>
    <script src="/blog/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/blog/libs/aos/aos.js"></script>
    <script src="/blog/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/blog/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/blog/js/matery.js"></script>

    
        <!-- <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script> -->
        <script src='/blog/libs/mermaid/mermaid.min.js'></script>
        <script>
          if (window.mermaid) {
            mermaid.initialize({theme: 'neutral'});
          }
        </script>
    

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/blog/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
